<div class="h-screen flex flex-col bg-gray-50 dark:bg-gray-900">
  <!-- Header -->
  <div class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 p-4">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Trading Signals Dashboard</h1>
      <div class="flex items-center space-x-4">
        <!-- Auto-refresh toggle -->
        <div class="flex items-center">
          <p-inputSwitch [(ngModel)]="autoRefresh" (onChange)="toggleAutoRefresh()"></p-inputSwitch>
          <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">Auto-refresh</span>
        </div>
        <!-- Connection status -->
        <div class="flex items-center">
          <div [class]="connectionStatus === 'connected' ? 'w-3 h-3 bg-green-500 rounded-full' : 'w-3 h-3 bg-red-500 rounded-full'"></div>
          <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">
            {{ connectionStatus === 'connected' ? 'Kapcsolódva' : 'Kapcsolat megszakadt' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Left Panel - Signals List -->
    <div class="w-1/3 flex flex-col border-r border-gray-200 dark:border-gray-700">
      <!-- Filters -->
      <div class="bg-white dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex space-x-4">
          <p-dropdown
            [options]="symbolOptions"
            [(ngModel)]="selectedSymbolFilter"
            (onChange)="applyFilters()"
            placeholder="Összes symbol"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
          <p-dropdown
            [options]="signalTypeOptions"
            [(ngModel)]="selectedSignalFilter"
            (onChange)="applyFilters()"
            placeholder="Összes jel"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
          <p-dropdown
            [options]="confidenceOptions"
            [(ngModel)]="selectedConfidenceFilter"
            (onChange)="applyFilters()"
            placeholder="Összes erősség"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
        </div>
      </div>

      <!-- Signals Table -->
      <div class="flex-1 overflow-auto bg-white dark:bg-gray-800">
        <p-table
          [value]="filteredSignals"
          [loading]="loading"
          [scrollable]="true"
          scrollHeight="100%"
          styleClass="p-datatable-sm"
        >
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 140px">Idő</th>
              <th style="width: 100px">Symbol</th>
              <th style="width: 80px">Jel</th>
              <th style="width: 100px">Erősség</th>
              <th style="width: 120px">Entry Price</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-signal let-rowIndex="rowIndex">
            <tr
              [class]="getRowClass(signal)"
              class="cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              [class.selected-row]="selectedSignal?.symbol === signal.symbol && selectedSignal?.timestamp === signal.timestamp"
              (click)="selectSignal(signal)"
            >
              <td class="text-sm">{{ signal.timestamp | date:'MM.dd HH:mm' }}</td>
              <td class="font-medium">{{ signal.symbol }}</td>
              <td>
                <p-tag
                  [value]="signal.signal"
                  [severity]="getSignalSeverity(signal.signal)"
                  class="text-xs"
                ></p-tag>
              </td>
              <td>
                <span class="text-sm font-medium">{{ getConfidenceText(signal.confidence) }}</span>
              </td>
              <td class="text-sm font-mono">${{ signal.entry_price | number:'1.2-6' }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center py-8">
                <i class="pi pi-info-circle text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400">Nincs elérhető szignál</p>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Middle Panel - Signal Details -->
    <div class="w-1/2 flex flex-col bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700">
      <div *ngIf="selectedSignal; else noSelection" class="flex-1 flex flex-col">
        <!-- Signal Header -->
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white">{{ selectedSignal.symbol }}</h2>
            <p-tag
              [value]="selectedSignal.signal"
              [severity]="getSignalSeverity(selectedSignal.signal)"
              class="text-lg px-4 py-2"
            ></p-tag>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {{ selectedSignal.timestamp | date:'yyyy.MM.dd HH:mm' }}
          </div>
        </div>

        <!-- Signal Details -->
        <div class="flex-1 p-4 overflow-auto">
          <!-- Price Information -->
          <div class="grid grid-cols-4 gap-3 mb-6">
            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <div class="text-sm text-blue-600 dark:text-blue-400 mb-1">Aktuális Ár</div>
              <div class="text-xl font-bold text-blue-600 dark:text-blue-400">${{ selectedSignal.current_price | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Entry Price</div>
              <div class="text-xl font-bold text-gray-900 dark:text-white">${{ selectedSignal.entry_price | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
              <div class="text-sm text-red-600 dark:text-red-400 mb-1">Stop Loss</div>
              <div class="text-xl font-bold text-red-600 dark:text-red-400">${{ selectedSignal.stop_loss | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
              <div class="text-sm text-green-600 dark:text-green-400 mb-1">Take Profit</div>
              <div class="text-xl font-bold text-green-600 dark:text-green-400">${{ selectedSignal.take_profit | number:'1.2-6' }}</div>
            </div>
          </div>

          <!-- Signal Decision Matrix -->
          <div class="mb-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center">
              <i class="pi pi-cog text-blue-600 mr-2"></i>
              Szignál Döntési Mátrix
              <span class="ml-2 text-sm font-normal text-gray-500">
                (Összpontszám: {{ selectedSignal.total_score || 0 }})
              </span>
            </h3>
            
            <div class="grid grid-cols-3 gap-2">
              <!-- Candlestick Pattern Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-chart-bar text-purple-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">Gyertyaminta</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="selectedSignal.decision_factors?.candlestick_pattern?.signal || 'NEUTRAL'"
                      [severity]="selectedSignal.decision_factors?.candlestick_pattern?.signal === 'BUY' ? 'success' : selectedSignal.decision_factors?.candlestick_pattern?.signal === 'SELL' ? 'danger' : 'secondary'"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="(selectedSignal.decision_factors?.candlestick_pattern?.weight || 0) > 0 ? 'text-green-600' : (selectedSignal.decision_factors?.candlestick_pattern?.weight || 0) < 0 ? 'text-red-600' : 'text-gray-600'">
                      {{ (selectedSignal.decision_factors?.candlestick_pattern?.weight || 0) > 0 ? '+' : '' }}{{ selectedSignal.decision_factors?.candlestick_pattern?.weight || 0 }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                  {{ getDecisionFactorName() }} ({{ getDecisionFactorScore() }}/5)
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('candlestick_pattern') }}
                </div>
              </div>

              <!-- Trend Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-arrow-up-right text-green-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">Trend</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('trend_analysis')"
                      [severity]="getDecisionFactorSeverity('trend_analysis')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('trend_analysis')">
                      {{ getDecisionFactorWeightDisplay('trend_analysis') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                  {{ getDecisionFactorTrend() }}
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('trend_analysis') }}
                </div>
              </div>

              <!-- RSI Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-chart-line text-blue-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">RSI</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('rsi_analysis')"
                      [severity]="getDecisionFactorSeverity('rsi_analysis')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('rsi_analysis')">
                      {{ getDecisionFactorWeightDisplay('rsi_analysis') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                  {{ getDecisionFactorValue('rsi_analysis') | number:'1.1-1' }}
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('rsi_analysis') }}
                </div>
              </div>

              <!-- MACD Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-sitemap text-orange-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">MACD</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('macd_analysis')"
                      [severity]="getDecisionFactorSeverity('macd_analysis')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('macd_analysis')">
                      {{ getDecisionFactorWeightDisplay('macd_analysis') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                  {{ getDecisionFactorValue('macd_analysis') | number:'1.2-2' }}
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('macd_analysis') }}
                </div>
              </div>

              <!-- Momentum Strength -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-bolt text-yellow-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">Momentum</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('momentum_strength')"
                      [severity]="getDecisionFactorSeverity('momentum_strength')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('momentum_strength')">
                      {{ getDecisionFactorWeightDisplay('momentum_strength') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                  {{ getDecisionFactorStrength() }}
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('momentum_strength') }}
                </div>
              </div>

              <!-- Volume Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-chart-bar text-indigo-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">Volume</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('volume_analysis')"
                      [severity]="getDecisionFactorSeverity('volume_analysis')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('volume_analysis')">
                      {{ getDecisionFactorWeightDisplay('volume_analysis') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('volume_analysis') }}
                </div>
              </div>

              <!-- Support/Resistance Analysis -->
              <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-2">
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center">
                    <i class="pi pi-minus text-gray-600 mr-1 text-xs"></i>
                    <span class="font-medium text-gray-900 dark:text-white text-xs">S/R</span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <p-tag
                      [value]="getDecisionFactorSignal('support_resistance')"
                      [severity]="getDecisionFactorSeverity('support_resistance')"
                      class="text-xs scale-75">
                    </p-tag>
                    <span class="text-xs font-medium"
                          [class]="getDecisionFactorWeightClass('support_resistance')">
                      {{ getDecisionFactorWeightDisplay('support_resistance') }}
                    </span>
                  </div>
                </div>
                <div class="text-xs text-gray-700 dark:text-gray-300 line-clamp-2">
                  {{ getDecisionFactorReasoning('support_resistance') }}
                </div>
              </div>
            </div>

            <!-- No Decision Factors Available -->
            <div *ngIf="!selectedSignal?.decision_factors" class="text-center py-8">
              <i class="pi pi-info-circle text-4xl text-gray-400 mb-4"></i>
              <p class="text-gray-500 dark:text-gray-400 mb-2">Döntési mátrix nem elérhető</p>
              <p class="text-sm text-gray-400 dark:text-gray-500">Ez a szignál még nem tartalmazza a részletes elemzési tényezőket.</p>
            </div>

            <!-- Final Decision Summary -->
            <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700">
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-semibold text-blue-900 dark:text-blue-100 mb-1">Végső Döntés</h4>
                  <p class="text-sm text-blue-700 dark:text-blue-300">
                    Az összes elemzési tényező alapján: <strong>{{ selectedSignal.signal }}</strong>
                  </p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-bold text-blue-900 dark:text-blue-100">
                    {{ selectedSignal.total_score || 0 }}
                  </div>
                  <div class="text-sm text-blue-600 dark:text-blue-400">Összpontszám</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Basic Signal Info -->
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <h3 class="text-md font-semibold text-gray-900 dark:text-white mb-2">Alapvető Technikai Elemzés</h3>
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Pattern:</span>
                  <span class="font-medium">{{ selectedSignal.pattern || 'Nincs felismert pattern' }}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Trend:</span>
                  <span class="font-medium">{{ selectedSignal.trend || 'N/A' }}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Score:</span>
                  <span class="font-medium">{{ selectedSignal.score || 0 }}/5</span>
                </div>
              </div>
            </div>
            <div>
              <h3 class="text-md font-semibold text-gray-900 dark:text-white mb-2">Kockázat</h3>
              <div class="space-y-2">
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Erősség:</span>
                  <span class="font-medium">{{ getConfidenceText(selectedSignal.confidence) }}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Risk/Reward:</span>
                  <span class="font-medium">{{ calculateRiskReward(selectedSignal) }}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Potential Loss:</span>
                  <span class="font-medium text-red-600">${{ calculatePotentialLoss(selectedSignal) | number:'1.2-2' }}</span>
                </div>
                <div class="flex justify-between text-sm">
                  <span class="text-gray-600 dark:text-gray-400">Potential Profit:</span>
                  <span class="font-medium text-green-600">${{ calculatePotentialProfit(selectedSignal) | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Trading Actions -->
          <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
            <h3 class="text-md font-semibold text-gray-900 dark:text-white mb-3">Kereskedési Műveletek</h3>
            <div class="grid grid-cols-2 gap-3">
              <p-button
                *ngIf="selectedSignal.signal === 'BUY'"
                label="Vásárlás"
                icon="pi pi-arrow-up"
                severity="success"
                size="small"
                (onClick)="executeTrade('BUY', selectedSignal)"
                class="w-full"
              ></p-button>
              <p-button
                *ngIf="selectedSignal.signal === 'SELL'"
                label="Eladás"
                icon="pi pi-arrow-down"
                severity="danger"
                size="small"
                (onClick)="executeTrade('SELL', selectedSignal)"
                class="w-full"
              ></p-button>
              <p-button
                label="Chart megjelenítése"
                icon="pi pi-chart-line"
                severity="secondary"
                size="small"
                (onClick)="showChart(selectedSignal)"
                class="w-full col-span-2"
              ></p-button>
            </div>
          </div>

          <p-divider *ngIf="selectedSignal?.decision_factors"></p-divider>

          <!-- AI Analysis Section -->
          <div class="mb-4">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center">
              <i class="pi pi-sparkles text-purple-600 mr-2"></i>
              AI Elemzés Részletei
            </h3>
            
            <!-- Loading State -->
            <div *ngIf="loadingAIAnalysis" class="space-y-4">
              <p-skeleton height="4rem"></p-skeleton>
              <p-skeleton height="6rem"></p-skeleton>
              <p-skeleton height="4rem"></p-skeleton>
            </div>

            <!-- AI Analysis Content -->
            <div *ngIf="!loadingAIAnalysis && selectedSignalAIAnalysis" class="space-y-6">
              
              <!-- Sentiment Analysis -->
              <p-accordion>
                <p-accordionTab header="🧠 Sentiment Elemzés" [selected]="true">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Általános Sentiment:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.sentiment.overall_sentiment > 0 ? 'text-green-600' : 'text-red-600'">
                          {{ selectedSignalAIAnalysis.sentiment.sentiment_label }}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Bizalom:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.sentiment.confidence | number:'1.0-0' }}%</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Hírek Sentiment:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.sentiment.news_sentiment > 0 ? 'text-green-600' : 'text-red-600'">
                          {{ selectedSignalAIAnalysis.sentiment.news_sentiment | number:'1.2-2' }}
                        </span>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Reddit Sentiment:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.sentiment.reddit_sentiment > 0 ? 'text-green-600' : 'text-red-600'">
                          {{ selectedSignalAIAnalysis.sentiment.reddit_sentiment | number:'1.2-2' }}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Fear & Greed Index:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.sentiment.fear_greed_index }}</span>
                      </div>
                      <div class="text-xs text-gray-500">
                        Elemzés ideje: {{ selectedSignalAIAnalysis.sentiment.analysis_time | date:'yyyy.MM.dd HH:mm' }}
                      </div>
                    </div>
                  </div>
                  <div class="mt-4">
                    <p-progressBar
                      [value]="Math.abs(selectedSignalAIAnalysis.sentiment.overall_sentiment) * 100"
                      [style]="{'height': '12px'}"
                      [ngClass]="{
                        'p-progressbar-success': selectedSignalAIAnalysis.sentiment.overall_sentiment > 0.2,
                        'p-progressbar-danger': selectedSignalAIAnalysis.sentiment.overall_sentiment < -0.2,
                        'p-progressbar-info': selectedSignalAIAnalysis.sentiment.overall_sentiment >= -0.2 && selectedSignalAIAnalysis.sentiment.overall_sentiment <= 0.2
                      }">
                    </p-progressBar>
                  </div>
                </p-accordionTab>

                <!-- Price Prediction -->
                <p-accordionTab header="📈 AI Árfolyam Előrejelzés">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Jelenlegi Ár:</span>
                        <span class="font-medium">${{ selectedSignalAIAnalysis.prediction.current_price | number:'1.2-6' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Előrejelzett Ár:</span>
                        <span class="font-medium">${{ selectedSignalAIAnalysis.prediction.predicted_price | number:'1.2-6' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Változás:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.prediction.price_change_percent > 0 ? 'text-green-600' : 'text-red-600'">
                          {{ selectedSignalAIAnalysis.prediction.price_change_percent | number:'1.2-2' }}%
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">ML Bizalom:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.prediction.confidence | number:'1.0-0' }}%</span>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Support Szint:</span>
                        <span class="font-medium">${{ selectedSignalAIAnalysis.prediction.support_level | number:'1.2-6' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Resistance Szint:</span>
                        <span class="font-medium">${{ selectedSignalAIAnalysis.prediction.resistance_level | number:'1.2-6' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Volatilitás:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.prediction.volatility | number:'1.2-4' }}</span>
                      </div>
                      <div class="text-xs text-gray-500">
                        {{ selectedSignalAIAnalysis.prediction.timeframe }} előrejelzés
                      </div>
                    </div>
                  </div>
                </p-accordionTab>

                <!-- Technical Indicators -->
                <p-accordionTab header="⚙️ Technikai Indikátorok">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">RSI:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.prediction.technical_indicators.rsi > 70 ? 'text-red-600' : selectedSignalAIAnalysis.prediction.technical_indicators.rsi < 30 ? 'text-green-600' : 'text-gray-900'">
                          {{ selectedSignalAIAnalysis.prediction.technical_indicators.rsi | number:'1.1-1' }}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">MACD:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.prediction.technical_indicators.macd > 0 ? 'text-green-600' : 'text-red-600'">
                          {{ selectedSignalAIAnalysis.prediction.technical_indicators.macd | number:'1.4-4' }}
                        </span>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Bollinger Pozíció:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.prediction.technical_indicators.bb_position }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Trend:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.prediction.technical_indicators.trend === 'bullish' ? 'text-green-600' : selectedSignalAIAnalysis.prediction.technical_indicators.trend === 'bearish' ? 'text-red-600' : 'text-gray-600'">
                          {{ selectedSignalAIAnalysis.prediction.technical_indicators.trend }}
                        </span>
                      </div>
                    </div>
                  </div>
                </p-accordionTab>

                <!-- Anomaly Detection -->
                <p-accordionTab header="🔍 Anomália Detektálás">
                  <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Volume Anomália:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.anomalies.volume_anomaly ? 'text-orange-600' : 'text-green-600'">
                          {{ selectedSignalAIAnalysis.anomalies.volume_anomaly ? 'Igen' : 'Nem' }}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Volume Z-Score:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.anomalies.volume_zscore | number:'1.2-2' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Volume Arány:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.anomalies.volume_ratio | number:'1.2-2' }}x</span>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Ár Anomália:</span>
                        <span class="font-medium" [class]="selectedSignalAIAnalysis.anomalies.price_anomaly ? 'text-orange-600' : 'text-green-600'">
                          {{ selectedSignalAIAnalysis.anomalies.price_anomaly ? 'Igen' : 'Nem' }}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Ár Z-Score:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.anomalies.price_zscore | number:'1.2-2' }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">Anomália Pontszám:</span>
                        <span class="font-medium">{{ selectedSignalAIAnalysis.anomalies.anomaly_score | number:'1.2-2' }}</span>
                      </div>
                    </div>
                  </div>
                </p-accordionTab>

                <!-- AI Recommendation -->
                <p-accordionTab header="🎯 AI Ajánlás">
                  <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                      <div>
                        <div class="text-lg font-bold text-blue-900 dark:text-blue-100">
                          {{ selectedSignalAIAnalysis.recommendation.action }}
                        </div>
                        <div class="text-sm text-blue-700 dark:text-blue-300">
                          Bizalom: {{ selectedSignalAIAnalysis.recommendation.confidence }}%
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm text-blue-600 dark:text-blue-400">AI Pontszám</div>
                        <div class="text-xl font-bold text-blue-900 dark:text-blue-100">
                          {{ selectedSignalAIAnalysis.recommendation.score }}
                        </div>
                      </div>
                    </div>
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                      <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI Indoklás:</div>
                      <div class="text-sm text-gray-600 dark:text-gray-400">
                        {{ selectedSignalAIAnalysis.recommendation.reasoning }}
                      </div>
                    </div>
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-600 dark:text-gray-400">Kockázati Pontszám:</span>
                      <span class="font-medium" [class]="selectedSignalAIAnalysis.risk_score > 70 ? 'text-red-600' : selectedSignalAIAnalysis.risk_score > 40 ? 'text-yellow-600' : 'text-green-600'">
                        {{ selectedSignalAIAnalysis.risk_score }}/100
                      </span>
                    </div>
                  </div>
                </p-accordionTab>
              </p-accordion>
            </div>

            <!-- No AI Analysis Available -->
            <div *ngIf="!loadingAIAnalysis && !selectedSignalAIAnalysis" class="text-center py-8">
              <i class="pi pi-exclamation-triangle text-4xl text-gray-400 mb-4"></i>
              <p class="text-gray-500 dark:text-gray-400">AI elemzés nem elérhető ehhez a szignálhoz</p>
            </div>
          </div>

        </div>
      </div>

      <ng-template #noSelection>
        <div class="flex-1 flex items-center justify-center">
          <div class="text-center">
            <i class="pi pi-chart-line text-6xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-900 dark:text-white mb-2">Válassz egy szignált</h3>
            <p class="text-gray-500 dark:text-gray-400">Kattints egy sorra a bal oldalon a részletek megtekintéséhez</p>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Right Panel - AI Insights -->
    <div class="w-1/6 bg-gray-50 dark:bg-gray-900 p-4 overflow-y-auto">
      <app-ai-insights-panel></app-ai-insights-panel>
    </div>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>

<!-- Chart Modal -->
<p-dialog
  [(visible)]="showChartModal"
  [header]="'Chart: ' + (selectedSignal?.symbol || '')"
  [modal]="true"
  [closable]="true"
  [resizable]="true"
  [maximizable]="true"
  styleClass="chart-modal"
  [style]="{width: '90vw', height: '80vh'}"
  (onHide)="closeChart()"
>
  <div class="w-full h-full" style="min-height: 600px;">
    <app-trading-view-widget
      *ngIf="selectedSignal && showChartModal"
      [symbol]="selectedSignal.symbol"
      [interval]="'1H'"
      [theme]="'light'"
    ></app-trading-view-widget>
  </div>
</p-dialog>