<div class="h-screen flex flex-col bg-gray-50 dark:bg-gray-900">
  <!-- Header -->
  <div class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 p-4">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Trading Signals Dashboard</h1>
      <div class="flex items-center space-x-4">
        <!-- Auto-refresh toggle -->
        <div class="flex items-center">
          <p-inputSwitch [(ngModel)]="autoRefresh" (onChange)="toggleAutoRefresh()"></p-inputSwitch>
          <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">Auto-refresh</span>
        </div>
        <!-- Connection status -->
        <div class="flex items-center">
          <div [class]="connectionStatus === 'connected' ? 'w-3 h-3 bg-green-500 rounded-full' : 'w-3 h-3 bg-red-500 rounded-full'"></div>
          <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">
            {{ connectionStatus === 'connected' ? 'Kapcsolódva' : 'Kapcsolat megszakadt' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Left Panel - Signals List -->
    <div class="w-1/2 flex flex-col border-r border-gray-200 dark:border-gray-700">
      <!-- Filters -->
      <div class="bg-white dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex space-x-4">
          <p-dropdown
            [options]="symbolOptions"
            [(ngModel)]="selectedSymbolFilter"
            (onChange)="applyFilters()"
            placeholder="Összes symbol"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
          <p-dropdown
            [options]="signalTypeOptions"
            [(ngModel)]="selectedSignalFilter"
            (onChange)="applyFilters()"
            placeholder="Összes jel"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
          <p-dropdown
            [options]="confidenceOptions"
            [(ngModel)]="selectedConfidenceFilter"
            (onChange)="applyFilters()"
            placeholder="Összes erősség"
            [showClear]="true"
            class="flex-1"
          ></p-dropdown>
        </div>
      </div>

      <!-- Signals Table -->
      <div class="flex-1 overflow-auto bg-white dark:bg-gray-800">
        <p-table
          [value]="filteredSignals"
          [loading]="loading"
          [scrollable]="true"
          scrollHeight="100%"
          styleClass="p-datatable-sm"
        >
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 140px">Idő</th>
              <th style="width: 100px">Symbol</th>
              <th style="width: 80px">Jel</th>
              <th style="width: 100px">Erősség</th>
              <th style="width: 120px">Aktuális Ár</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-signal let-rowIndex="rowIndex">
            <tr
              [class]="getRowClass(signal)"
              class="cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              [class.selected-row]="selectedSignal?.symbol === signal.symbol && selectedSignal?.timestamp === signal.timestamp"
              (click)="selectSignal(signal)"
            >
              <td class="text-sm">{{ signal.timestamp | date:'MM.dd HH:mm':'hu-HU' }}</td>
              <td class="font-medium">{{ signal.symbol }}</td>
              <td>
                <p-tag
                  [value]="signal.signal"
                  [severity]="getSignalSeverity(signal.signal)"
                  class="text-xs"
                ></p-tag>
              </td>
              <td>
                <span class="text-sm font-medium">{{ getConfidenceText(signal.confidence) }}</span>
              </td>
              <td class="text-sm font-mono">${{ signal.current_price | number:'1.2-6' }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center py-8">
                <i class="pi pi-info-circle text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400">Nincs elérhető szignál</p>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Right Panel - Signal Details -->
    <div class="w-1/2 flex flex-col bg-white dark:bg-gray-800">
      <div *ngIf="selectedSignal; else noSelection" class="flex-1 flex flex-col">
        <!-- Signal Header -->
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white">{{ selectedSignal.symbol }}</h2>
            <p-tag
              [value]="selectedSignal.signal"
              [severity]="getSignalSeverity(selectedSignal.signal)"
              class="text-lg px-4 py-2"
            ></p-tag>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {{ selectedSignal.timestamp | date:'yyyy.MM.dd HH:mm':'hu-HU' }}
          </div>
        </div>

        <!-- Signal Details -->
        <div class="flex-1 p-6 overflow-auto">
          <!-- Price Information -->
          <div class="grid grid-cols-4 gap-4 mb-8">
            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <div class="text-sm text-blue-600 dark:text-blue-400 mb-1">Aktuális Ár</div>
              <div class="text-xl font-bold text-blue-600 dark:text-blue-400">${{ selectedSignal.current_price | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Entry Price</div>
              <div class="text-xl font-bold text-gray-900 dark:text-white">${{ selectedSignal.entry_price | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
              <div class="text-sm text-red-600 dark:text-red-400 mb-1">Stop Loss</div>
              <div class="text-xl font-bold text-red-600 dark:text-red-400">${{ selectedSignal.stop_loss | number:'1.2-6' }}</div>
            </div>
            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
              <div class="text-sm text-green-600 dark:text-green-400 mb-1">Take Profit</div>
              <div class="text-xl font-bold text-green-600 dark:text-green-400">${{ selectedSignal.take_profit | number:'1.2-6' }}</div>
            </div>
          </div>

          <!-- Technical Analysis -->
          <div class="grid grid-cols-2 gap-6 mb-8">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Technikai Elemzés</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Pattern:</span>
                  <span class="font-medium">{{ selectedSignal.pattern || 'Nincs felismert pattern' }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Trend:</span>
                  <span class="font-medium">{{ selectedSignal.trend || 'N/A' }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Score:</span>
                  <span class="font-medium">{{ selectedSignal.score || 0 }}/5</span>
                </div>
              </div>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Kockázat</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Erősség:</span>
                  <span class="font-medium">{{ getConfidenceText(selectedSignal.confidence) }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Risk/Reward:</span>
                  <span class="font-medium">{{ calculateRiskReward(selectedSignal) }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Potential Loss:</span>
                  <span class="font-medium text-red-600">${{ calculatePotentialLoss(selectedSignal) | number:'1.2-2' }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600 dark:text-gray-400">Potential Profit:</span>
                  <span class="font-medium text-green-600">${{ calculatePotentialProfit(selectedSignal) | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Trading Actions -->
          <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Kereskedési Műveletek</h3>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <p-button
                *ngIf="selectedSignal.signal === 'BUY'"
                label="Vásárlás"
                icon="pi pi-arrow-up"
                severity="success"
                size="large"
                (onClick)="executeTrade('BUY', selectedSignal)"
                class="w-full"
              ></p-button>
              <p-button
                *ngIf="selectedSignal.signal === 'SELL'"
                label="Eladás"
                icon="pi pi-arrow-down"
                severity="danger"
                size="large"
                (onClick)="executeTrade('SELL', selectedSignal)"
                class="w-full"
              ></p-button>
              <p-button
                label="Chart megjelenítése"
                icon="pi pi-chart-line"
                severity="secondary"
                size="large"
                (onClick)="showChart(selectedSignal)"
                class="w-full col-span-2"
              ></p-button>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noSelection>
        <div class="flex-1 flex items-center justify-center">
          <div class="text-center">
            <i class="pi pi-chart-line text-6xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-900 dark:text-white mb-2">Válassz egy szignált</h3>
            <p class="text-gray-500 dark:text-gray-400">Kattints egy sorra a bal oldalon a részletek megtekintéséhez</p>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>

<!-- Chart Modal -->
<p-dialog
  [(visible)]="showChartModal"
  [header]="'Chart: ' + (selectedSignal?.symbol || '')"
  [modal]="true"
  [closable]="true"
  [resizable]="true"
  [maximizable]="true"
  styleClass="chart-modal"
  [style]="{width: '90vw', height: '80vh'}"
>
  <div class="w-full h-full" style="min-height: 600px;">
    <app-trading-view-widget
      *ngIf="selectedSignal && showChartModal"
      [symbol]="selectedSignal.symbol"
      [interval]="'1H'"
      [theme]="'light'"
    ></app-trading-view-widget>
  </div>
</p-dialog>