<div class="portfolio-container">
  <div class="portfolio-header">
    <h1>Portfolio Overview</h1>
    
    <div class="period-selector">
      <label for="period">Time Period</label>
      <p-dropdown 
        id="period"
        [options]="timePeriods" 
        [(ngModel)]="selectedPeriod" 
        optionLabel="label"
        optionValue="value"
        (onChange)="onPeriodChange()"
        styleClass="w-full"
      ></p-dropdown>
    </div>
  </div>
  
  <!-- Summary Cards -->
  <ng-container *ngIf="portfolioSummary$ | async as portfolioSummary">
    <div class="summary-cards" *ngIf="!(loading$ | async)">
      <p-card styleClass="summary-card">
        <div class="summary-content">
          <div class="summary-icon profit-icon">
            <i class="pi pi-dollar"></i>
          </div>
          <div class="summary-data">
            <div class="summary-title">Total Profit</div>
            <div class="summary-value" [ngClass]="getProfitClass(portfolioSummary.totalProfit)">
              ${{ portfolioSummary.totalProfit.toFixed(2) }}
            </div>
            <div class="summary-subvalue" [ngClass]="getProfitClass(portfolioSummary.totalProfitPercentage)">
              {{ portfolioSummary.totalProfitPercentage.toFixed(2) }}%
            </div>
          </div>
        </div>
      </p-card>
      
      <p-card styleClass="summary-card">
        <div class="summary-content">
          <div class="summary-icon trades-icon">
            <i class="pi pi-chart-line"></i>
          </div>
          <div class="summary-data">
            <div class="summary-title">Total Trades</div>
            <div class="summary-value">{{ portfolioSummary.totalTrades }}</div>
            <div class="summary-subvalue">
              Win Rate: {{ (portfolioSummary.winRate * 100).toFixed(1) }}%
            </div>
          </div>
        </div>
      </p-card>
      
      <p-card styleClass="summary-card">
        <div class="summary-content">
          <div class="summary-icon coin-icon">
            <i class="pi pi-star"></i>
          </div>
          <div class="summary-data">
            <div class="summary-title">Top Performing Coin</div>
            <div class="summary-value">{{ portfolioSummary.topPerformingCoin.symbol }}</div>
            <div class="summary-subvalue" [ngClass]="getProfitClass(portfolioSummary.topPerformingCoin.profit)">
              ${{ portfolioSummary.topPerformingCoin.profit.toFixed(2) }} ({{ portfolioSummary.topPerformingCoin.profitPercentage.toFixed(2) }}%)
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </ng-container>
  
  <!-- Loading Placeholder -->
  <div class="loading-placeholder" *ngIf="loading$ | async">
    <p-progressSpinner [style]="{width: '50px', height: '50px'}" styleClass="custom-spinner" strokeWidth="4"></p-progressSpinner>
    <div>Loading portfolio data...</div>
  </div>
  
  <!-- Charts Section -->
  <ng-container *ngIf="portfolioSummary$ | async as portfolioSummary">
    <div class="charts-section" *ngIf="!(loading$ | async)">
      <div class="chart-row">
        <!-- Daily Profit Chart -->
        <p-card styleClass="chart-card" header="Daily Profit">
          <div class="chart-container">
            <p-chart type="bar" [data]="dailyProfitChartData$ | async" [options]="chartOptions"></p-chart>
          </div>
        </p-card>
        
        <!-- Coin Performance Chart -->
        <p-card styleClass="chart-card" header="Profit by Coin">
          <div class="chart-container">
            <p-chart type="pie" [data]="coinPerformanceChartData$ | async" [options]="chartOptions"></p-chart>
          </div>
        </p-card>
      </div>
    </div>
  
    <!-- Trade Summary Table -->
    <p-card *ngIf="!(loading$ | async)" header="Trade Summary" styleClass="trade-summary-card">
      <p-table [value]="portfolioSummary.tradeSummary" styleClass="p-datatable-striped">
        <ng-template pTemplate="header">
          <tr>
            <th>Coin</th>
            <th>Trades</th>
            <th>Wins</th>
            <th>Losses</th>
            <th>Win Rate</th>
            <th>Profit</th>
            <th>Avg. Hold Time</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-summary>
          <tr>
            <td>{{ summary.symbol }}</td>
            <td>{{ summary.trades }}</td>
            <td>{{ summary.wins }}</td>
            <td>{{ summary.losses }}</td>
            <td>{{ (summary.wins / summary.trades * 100).toFixed(1) }}%</td>
            <td [ngClass]="getProfitClass(summary.profit)">
              ${{ summary.profit.toFixed(2) }} ({{ summary.profitPercentage.toFixed(2) }}%)
            </td>
            <td>{{ summary.averageHoldTime.toFixed(1) }} hours</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </ng-container>
</div>